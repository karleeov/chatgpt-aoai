{"version":3,"sources":["../../../src/server/devBrowser.ts"],"sourcesContent":["// TODO: This is a partial duplicate of part of packages/clerk-js/src/utils/devBrowser.ts\n// TODO: To be removed when we can extract this utility to @clerk/shared\n\nexport const DEV_BROWSER_SSO_JWT_PARAMETER = '__dev_session';\n\n//\n// Below this line should be identical to clerk-js version\n//\n\nexport const DEV_BROWSER_JWT_MARKER = '__clerk_db_jwt';\nconst DEV_BROWSER_JWT_MARKER_REGEXP = /__clerk_db_jwt\\[(.*)\\]/;\n\n// Sets the dev_browser JWT in the hash or the search\nexport function setDevBrowserJWTInURL(url: URL, jwt: string, asQueryParam: boolean): URL {\n  const resultURL = new URL(url);\n\n  // extract & strip existing jwt from hash\n  const jwtFromHash = extractDevBrowserJWTFromHash(resultURL.hash);\n  resultURL.hash = resultURL.hash.replace(DEV_BROWSER_JWT_MARKER_REGEXP, '');\n  if (resultURL.href.endsWith('#')) {\n    resultURL.hash = '';\n  }\n\n  // extract & strip existing jwt from search\n  const jwtFromSearch = resultURL.searchParams.get(DEV_BROWSER_SSO_JWT_PARAMETER);\n  resultURL.searchParams.delete(DEV_BROWSER_SSO_JWT_PARAMETER);\n\n  // Existing jwt takes precedence\n  const jwtToSet = jwtFromHash || jwtFromSearch || jwt;\n\n  if (jwtToSet) {\n    if (asQueryParam) {\n      resultURL.searchParams.append(DEV_BROWSER_SSO_JWT_PARAMETER, jwtToSet);\n    } else {\n      resultURL.hash = resultURL.hash + `${DEV_BROWSER_JWT_MARKER}[${jwtToSet}]`;\n    }\n  }\n\n  return resultURL;\n}\n\nfunction extractDevBrowserJWTFromHash(hash: string): string {\n  const matches = hash.match(DEV_BROWSER_JWT_MARKER_REGEXP);\n  return matches ? matches[1] : '';\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGO,MAAM,gCAAgC;AAMtC,MAAM,yBAAyB;AACtC,MAAM,gCAAgC;AAG/B,SAAS,sBAAsB,KAAU,KAAa,cAA4B;AACvF,QAAM,YAAY,IAAI,IAAI,GAAG;AAG7B,QAAM,cAAc,6BAA6B,UAAU,IAAI;AAC/D,YAAU,OAAO,UAAU,KAAK,QAAQ,+BAA+B,EAAE;AACzE,MAAI,UAAU,KAAK,SAAS,GAAG,GAAG;AAChC,cAAU,OAAO;AAAA,EACnB;AAGA,QAAM,gBAAgB,UAAU,aAAa,IAAI,6BAA6B;AAC9E,YAAU,aAAa,OAAO,6BAA6B;AAG3D,QAAM,WAAW,eAAe,iBAAiB;AAEjD,MAAI,UAAU;AACZ,QAAI,cAAc;AAChB,gBAAU,aAAa,OAAO,+BAA+B,QAAQ;AAAA,IACvE,OAAO;AACL,gBAAU,OAAO,UAAU,OAAO,GAAG,0BAA0B;AAAA,IACjE;AAAA,EACF;AAEA,SAAO;AACT;AAEA,SAAS,6BAA6B,MAAsB;AAC1D,QAAM,UAAU,KAAK,MAAM,6BAA6B;AACxD,SAAO,UAAU,QAAQ,CAAC,IAAI;AAChC;","names":[]}